<!DOCTYPE html>
<html lang="en">
  <%- include('include/header', { title: 'search' }) %>
  <body>
    <nav class="nav"><%- include('include/navi') %></nav>

    <main class="container search_wrap">
      <div class="content">
        <h3 class="sub_title"><span>검색 결과</span></h3>
        <div class="card-container add" id="cardContainer">
          <% if (todos && todos.length > 0) { %> <% todos.forEach((todo) => { %>
          <div class="card">
            <div class="card-title"><%= todo.title %></div>
            <ul class="todo-list">
              <% (todo.todo_contents || []).forEach((content) => { %>
              <li class="<%= content.state ? 'completed' : '' %>">
                <%= content.content %>
              </li>
              <% }) %>
            </ul>
          </div>
          <% }) %> <% } else { %>
          <p>검색 결과가 없습니다.</p>
          <% } %>
        </div>
      </div>
    </main>

    <%- include('include/popup') %>

    <script>
      // 검색 버튼 이벤트 처리
      document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('search-comment');
        const searchButton = document.querySelector('.naviBar button');

        if (searchInput && searchButton) {
          searchButton.addEventListener('click', () => {
            const query = searchInput.value.trim();
            if (query) {
              window.location.href = `/todo/api/search?query=${encodeURIComponent(
                query,
              )}`;
            } else {
              alert('검색어를 입력해주세요.');
            }
          });

          searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
              searchButton.click();
            }
          });
        }
      });

      const cardContainer = document.getElementById('cardContainer');
      if (cardContainer) {
        cardContainer.addEventListener('click', (e) => {
          const card = e.target.closest('.card');
          if (card) {
            const title = card.querySelector('.card-title').textContent.trim();
            alert(`"${title}"를 선택했습니다.`);
          }
        });
      }
    </script>
  </body>
</html>
