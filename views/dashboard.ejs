<!DOCTYPE html>
<html lang="en">
  <%- include('include/header', { title: 'Calendar' }) %>
  <style>
    .date {
      position: relative;
      cursor: pointer;
    }

    .todo-marker {
      position: absolute;
      bottom: 5px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      background-color: #ff6347;
      border-radius: 50%;
    }
  </style>
  <body>
    <!-- Navigation -->
    <nav class="nav"><%- include('include/navi') %></nav>

    <!-- Main Content -->
    <main class="container calendar_wrap">
      <div class="content">
        <!-- Calendar Section -->
        <div class="calendar">
          <div class="header">
            <button id="prevMonth">&lt;</button>
            <h2 id="monthYear">
              <%= new Date(selectedDate).toLocaleString('default', { month:
              'long', year: 'numeric' }) %>
            </h2>
            <button id="nextMonth">&gt;</button>
          </div>
          <div class="days">
            <% const days = ['일', '월', '화', '수', '목', '금', '토']; %> <%
            days.forEach(day => { %>
            <div><%= day %></div>
            <% }) %>
          </div>
          <div class="dates">
            <% const firstDay = new Date(new Date(selectedDate).getFullYear(),
            new Date(selectedDate).getMonth(), 1).getDay(); const lastDate = new
            Date(new Date(selectedDate).getFullYear(), new
            Date(selectedDate).getMonth() + 1, 0).getDate(); for (let i = 0; i <
            firstDay; i++) { %>
            <div></div>
            <% } %> <% for (let i = 1; i <= lastDate; i++) { const
            currentDateKey = `${new Date(selectedDate).getFullYear()}-${(new
            Date(selectedDate).getMonth() + 1).toString().padStart(2,
            '0')}-${i.toString().padStart(2, '0')}`; const todoForDate =
            todos.filter(todo => todo.date === currentDateKey); %>
            <div class="date" data-date="<%= currentDateKey %>">
              <span><%= i %></span>
              <% if (todoForDate.length > 0) { %>
              <div class="todo-marker"></div>
              <% } %>
            </div>
            <% } %>
          </div>
        </div>

        <!-- Todo -->
        <div class="todo-list">
          <h2>스케줄:</h2>
          <h3 id="selected-date"><%= selectedDate %></h3>
          <ul id="todo-items">
            <% todos.filter(todo => todo.date === selectedDate).forEach(todo =>
            { %>
            <li>
              <a
                href="/todo/api/search?query=<%= encodeURIComponent(todo.title) %>"
              >
                <%= todo.title %>
              </a>
            </li>
            <% }) %>
          </ul>
        </div>
      </div>
    </main>

    <!-- Popup Include -->
    <%- include('include/popup') %>

    <!-- Axios Library -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Calendar Script -->
    <script>
      const prevMonth = document.getElementById('prevMonth');
      const nextMonth = document.getElementById('nextMonth');
      const dates = document.querySelectorAll('.date');

      // 이전 달로 이동
      prevMonth.addEventListener('click', () => {
        const currentDate = new Date('<%= selectedDate %>');
        currentDate.setMonth(currentDate.getMonth() - 1);
        window.location.href = `/todo/api/calendar?date=${
          currentDate.toISOString().split('T')[0]
        }`;
      });

      // 다음 달로 이동
      nextMonth.addEventListener('click', () => {
        const currentDate = new Date('<%= selectedDate %>');
        currentDate.setMonth(currentDate.getMonth() + 1);
        window.location.href = `/todo/api/calendar?date=${
          currentDate.toISOString().split('T')[0]
        }`;
      });

      // 날짜 선택 이벤트
      dates.forEach((date) => {
        date.addEventListener('click', () => {
          const selectedDate = date.getAttribute('data-date');
          window.location.href = `/todo/api/calendar?date=${selectedDate}`;
        });
      });
    </script>
  </body>
</html>
