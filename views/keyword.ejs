<!DOCTYPE html>
<html lang="en">
  <%- include('include/header', { title: 'keyword' }) %>
  <body>
    <!-- 네비게이션 부분 -->
    <nav class="nav"><%- include('include/navi') %></nav>

    <main class="container keyword_wrap">
      <div class="content">
        <h3 class="sub_title"><span>키워드</span></h3>
        <div class="card-container add">
          <% if (keywords && keywords.length > 0) { %>
          <%keywords.forEach((keyword) => { %>
          <div class="card">
            <div class="card-title"><%= keyword.keyword %></div>
          </div>
          <% }) %> <% } else { %>
          <div>표시할 키워드가 없습니다.</div>
          <% } %>
        </div>
      </div>
    </main>

    <%- include('include/popup') %>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const userId = 1;
        const keywordContainer = document.querySelector('.card-container.add');

        const fetchKeywords = async () => {
          keywordContainer.innerHTML = '<div>로딩 중...</div>';

          try {
            const response = await fetch(`/todo/api/list/keyword/${userId}`);
            if (!response.ok) throw new Error('네트워크 응답 실패');
            console.log(response);
            const data = await response.json();

            console.log(data);
            keywordContainer.innerHTML = '';

            if (!data.keywords || data.keywords.length === 0) {
              keywordContainer.innerHTML =
                '<div>표시할 키워드가 없습니다.</div>';
              return;
            }

            data.keywords.forEach((keyword) => {
              const card = document.createElement('div');
              card.className = 'card';

              const cardTitle = document.createElement('div');
              cardTitle.className = 'card-title';
              cardTitle.textContent = keyword.keyword;

              card.appendChild(cardTitle);
              keywordContainer.appendChild(card);
            });
          } catch (error) {
            keywordContainer.innerHTML = '';
            alert(
              '키워드를 불러오는 중 오류가 발생했습니다. 잠시 후 다시 시도해주세요.',
            );
            console.error('키워드 데이터를 가져오는 중 오류 발생:', error);
          }
        };

        fetchKeywords();
      });
    </script>
  </body>
</html>
